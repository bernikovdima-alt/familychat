<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–µ–º–µ–π–Ω–∞—è –í–∏–¥–µ–æ—Å–≤—è–∑—å</title>
    <script src='https://meet.jit.si/external_api.js'></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #222; overflow: hidden; }
        
        /* –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è */
        #welcome-screen {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100%; color: white; text-align: center;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        h1 { margin-bottom: 10px; font-size: 24px; }
        p { color: #ddd; margin-bottom: 30px; }

        .btn {
            background: #25D366; color: white; border: none; padding: 18px 40px; 
            font-size: 18px; border-radius: 50px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s;
            width: 80%; max-width: 300px; text-decoration: none; display: inline-block;
        }
        .btn:active { transform: scale(0.95); }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–µ–æ */
        #meet { width: 100%; height: 100%; display: none; }
        
        /* –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –≤–Ω—É—Ç—Ä–∏ –∑–≤–æ–Ω–∫–∞ */
        #share-btn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 100; background: #fff; color: #333; font-size: 14px;
            padding: 10px 20px; border-radius: 20px; display: none; cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <h1>üìû –í–∏–¥–µ–æ—Å–≤—è–∑—å</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É<br>–∏ –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –º–∞–º—ã.</p>
        <button class="btn" onclick="startCall()">–ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
    </div>

    <div id="meet"></div>
    <div id="share-btn" onclick="shareLink()">üîó –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –º–∞–º–µ</div>

    <script>
        let api = null;

        function startCall() {
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–º–Ω–∞—Ç–∞ –≤ —Å—Å—ã–ª–∫–µ
            const urlParams = new URLSearchParams(window.location.search);
            let roomName = urlParams.get('room');

            // –ï—Å–ª–∏ –∫–æ–º–Ω–∞—Ç—ã –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é (FamilyChat + —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã)
            if (!roomName) {
                const randomId = Math.floor(Math.random() * 100000);
                roomName = 'FamilyChat_' + randomId;
                // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?room=' + roomName;
                window.history.pushState({path:newUrl},'',newUrl);
            }

            // 2. –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('meet').style.display = 'block';
            document.getElementById('share-btn').style.display = 'block';

            // 3. –ó–∞–ø—É—Å–∫–∞–µ–º Jitsi
            const domain = 'meet.jit.si';
            const options = {
                roomName: roomName,
                width: '100%',
                height: '100%',
                parentNode: document.querySelector('#meet'),
                lang: 'ru',
                configOverwrite: { 
                    startWithAudioMuted: false, 
                    startWithVideoMuted: false,
                    prejoinPageEnabled: false // –°—Ä–∞–∑—É –≤—Ö–æ–¥–∏–º, –±–µ–∑ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                },
                interfaceConfigOverwrite: {
                    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –º–∞–º–µ –±—ã–ª–æ –ø—Ä–æ—â–µ
                    TOOLBAR_BUTTONS: [
                        'microphone', 'camera', 'hangup', 'tileview', 'fullscreen'
                    ],
                    MOBILE_APP_PROMO: false
                }
            };

            api = new JitsiMeetExternalAPI(domain, options);

            // –ï—Å–ª–∏ –∑–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            api.addEventListeners({
                videoConferenceLeft: function () {
                    window.location.href = window.location.href.split('?')[0];
                }
            });
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('room')) {
                startCall();
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
        function shareLink() {
            const link = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: '–ü–æ–∑–≤–æ–Ω–∏ –º–Ω–µ!',
                    text: '–ù–∞–∂–º–∏ –Ω–∞ —Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫:',
                    url: link
                });
            } else {
                prompt("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:", link);
            }
        }
    </script>
</body>
</html>
